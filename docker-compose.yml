version: '3.8'

services:
  valkey-fips:
    image: valkey-fips:8.1.5-ubuntu-22.04
    container_name: valkey-fips
    ports:
      - "6379:6379"
    volumes:
      - valkey-data:/bitnami/valkey/data
    environment:
      # Valkey authentication (choose one):
      # Option 1: With password (recommended for production)
      - VALKEY_PASSWORD=your_secure_password
      # Option 2: Without password (development only)
      # - ALLOW_EMPTY_PASSWORD=yes

      # FIPS environment (pre-configured in image, shown for reference)
      # - OPENSSL_CONF=/usr/local/openssl/ssl/openssl.cnf
      # - OPENSSL_MODULES=/usr/local/lib64/ossl-modules
      # - LD_LIBRARY_PATH=/usr/local/openssl/lib64:/usr/local/lib
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "valkey-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  valkey-data:
    driver: local

networks:
  default:
    name: valkey-fips-network
